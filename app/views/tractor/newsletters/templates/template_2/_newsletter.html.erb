<% template_path = "tractor/newsletters/templates/template_2/" %>

<%= render :partial => template_path + 'html_header' %>

<table class="newsie" cellspacing="0" cellpadding="0" bgcolor="#FFFFFF" border="0" align="center" style="margin: 0 auto; padding: 0; width:700px; border: none; background: #fff" width="700">
  <tr>
    <td style="margin: 0; padding: 0; width: 100%;">
      <%= render :partial => template_path + 'email_header' %>

      <table class="newsie" cellspacing="0" cellpadding="0"  align="center" bgcolor="#ffffff" border="0" style="width: 100%; padding: 0; margin: 0; background: #fff" >
        <tr>
          <td style="width: 20px; margin: 0; padding: 0;background: #fff">
          </td>
          <td valign="top" style="padding-bottom: 2px; background: #fff"> 

            <% @newsletter.newsletter_blocks.each_with_index do |block, index| %>
              <% if block.just_image %>
                <%= render :partial => template_path + 'banner', :locals => { :block => block } %>
              <% end %>
              <% if block.just_headline  %>
                <table cellspacing="0" style="text-align: center; margin-bottom: 8px;" >
                  <tr>
                    <td bgcolor="#333" style="width: 660px; text-align: center; position: relative;" width="660">
                      <table style="margin: 8px auto; text-align: center;" align="center"><tr><td style="text-align: center; ">

                            <%= link_to("edit", edit_newsletter_block_path(block),:class => "btn", :style => "position: absolute; top: 0; left: 0; padding: 10px;" ) if current_user && params[:send_version] != "0" %>

                            <%= content_tag(:h1, raw(block.main_title), :style => "color: #e5e5e5; font-size: 28px;  font-family: Gil Sans, Helvetica, Arial, Sans-serif; line-height: 28px") %>

                      </td></tr></table>
                    </td>
                  </tr>
                </table>

              <% end %>

              <% 
                  ## If we're dealing with a full block type do this:
                if block.full_block
                  if !@newsletter.newsletter_blocks[index - 1].full_block
                    ## if the block before this block is not a "full block then we can assume this is First.
                    is_first = true
                  else
                    # otherwise we need to figure out if it's an even one or an odd one...
                    (2..20).each do |less|
                      break if !@newsletter.newsletter_blocks[index - less].full_block
                      if @newsletter.newsletter_blocks[index - less].full_block
                        is_first = true
                        if(less % 2 > 0)
                          is_first = false
                        end
                      end
                    end
                  end
                  %>


                <% if is_first == true  %>

                  <table style="padding: 10px; background: #eeeeee;">
                    <tr>
                      <td>
                        <%= render :partial => template_path + "block_type_2", :locals => { :block => nblock(index), :block_2 => nblock(index + 1) } %>
                      </td>
                    </tr>
                  </table>
                  <br/>
                <% end %>
              <% end %>

            <% if block.text_only  %>

<table style="background: #fff;">
                    <tr>
                      <td style="position: relative;">
                        <%= link_to("edit", edit_newsletter_block_path(block),:class => "btn", :style => "position: absolute; top: 0; right: 0; padding: 10px;" ) if current_user && params[:send_version] != "0" %>
                        <h1 style="font-size: 20px; line-height: 26px; margin: 10px 0; color: #b8151a;"><%= block.main_title  %></h2>
                        <%= raw (RedCloth.new(block.body).to_html).gsub('<p', '<p style="color: #333; font-size: 14px; margin: 0 0 12px 0"').gsub('<h2','<h2 style="color: #333; font-size: 18px; margin: 18px 0 12px 0;"') if block.body %>
                      </td>
                    </tr>
                  </table>


                <% end %>
              <% end %>
          </td>
          <td style="width:20px;" width="20"></td> 
        </tr> 
      </table> 

      <%= render :partial => template_path + 'navbar' %>

      <table> 
        <tr> 
          <td width="20"></td> 
          <td  width="300"> 
            <%= render :partial => template_path + 'why_this_message' %>
          </td>
          <td width="40"></td> 
          <td  width="160" valign="top"> 
            <br/>        <br/>      <br/> 
            <%= render :partial => template_path + 'social_links' %>

          </td> 

          <td  width="160" valign="top"> 
            <br/>      <br/>      <br/> 
            <table style="font-size: 12px;"> 
              <tr> 
                <td valign="top"></td> 
                <td valign="top"><a href="https://www.cellarmasterwines.com" style="margin: 0 6px; color: #767676; text-decoration: none;">Order Online &raquo;</a></td> 
              </tr> 
              <tr> 
                <td valign="top"></td> 
                <td valign="top"><a href="https://www.cellarmasterwines.com/about-us" style="margin: 0 6px; color: #767676; text-decoration: none;">About Us &raquo;</a></td> 
              </tr> 
              <tr> 
                <td valign="top"></td> 
                <td valign="top"><a href="https://www.cellarmasterwines.com/privacy-policy" style="margin: 0 6px; color: #767676; text-decoration: none;">Privacy Policy &raquo;</a></td> 
              </tr> 
              <tr> 
                <td valign="top"></td> 
                <td valign="top"><a href="https://www.cellarmasterwines.com/terms-and-conditions" style="margin: 0 6px; color: #767676; text-decoration: none;">Terms &amp; Conditions &raquo;</a></td> 
              </tr> 

            </table> 


          </td> 
          <td width="20"></td> 
        </tr> 
      </table>&nbsp;

    </td> 
  </tr> 
</table> 

<table style="background: none; border: none; margin: 5px auto 10px auto; padding: 0; color: #bbb; font-size: 10px; font-weight: normal; font-family: sans-serif; line-height: 14px; width: 700px;" align="center" width="700"> 
  <tr> 
    <td style="border: none; margin: 0; padding: 0;" width="20"> 
    </td> 
    <td style="border: none; color: #bebebe; font-size: 10px; font-weight: normal; font-family: sans-serif; text-align: center" width="650"> 
      <% unless @newsletter.content.include?("jpg")  %>
        <p style="font-size: 11px;" align="center"><% end %> <br/> This email was sent to [email]. If you are no longer interested you can <unsubscribe style="border: none;text-decoration: none; color: #ccc;"><span style="border: none; color: #fff; text-decoration: none;">unsubscribe instantly</span></unsubscribe>.
      <br/>Â© Copyright 2012 CellarMasterWines Wine Club<br/>9/F, Tin Fung Industrial Mansion, 63 Wong Chuk Hang Road, HK</p> 


    </td> 
    <td style="border: none;"  width="20"> </td> 
  </tr> 
</table> 



<br /> 



    </div> 

    <style> 
      .news_reset * { border: 0; margin: 0; padding: 0; font-size: 12px; font-family: sans-serif;}
      .newsie_background { background: #333333; margin: 0; padding: 10px 0; width: 100%; }
      .newsie table, .newsie table tr, .newsie table tr td { border: none; padding: 0; margin: 0; font: normal sans-serif; line-height: 20px;}
      .newsie table.dotted-top { border-top: 1px dotted #808080; }
      .newsie .featured p, .newsie .col_three p,.newsie .left_col p { font-size: 12px; line-height: 20px; margin-bottom: 12px; color: #080808;  }
      .newsie table * { font-size: 12px; line-height: 20px; color: #080808;}
      table.dotted-both {border-top: 1px dotted #808080; border-bottom: 1px dotted #808080;}
      .newsie table h3 { font-size: 18px; color: #6d1417; line-height: 32px; font-family: Georgia, Times, Helvetica; }
      .newsie p strong, .newsie p a { font-size: 14px;}
    </style> 
  </div> 
